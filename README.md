# Casiotone-Hi-Hat-Analysis
Analysis of Casiotone MT-45/MT-46 hi hat/cymbal generation

The Casio Casiotone MT-45/MT-46 hi-hat/cymbal is comprised of two noise 
generators: one for the metallic noise and one for white noise. These are
both generated by the PD930G Accompaniment LSI microcontroller; the metallic 
noise outputted from pin 23 and the white noise being outputted from pin 22
using pulse width modulation.

![image1](https://github.com/astriiddev/Casiotone-Hi-Hat-Analysis/assets/98296288/1af69329-28ba-475a-bf39-354de4e2b338)

The pulses generated are in multiples of a base interval of 39 microseconds,
with a variance of +/- 2 microseconds due to variances in the LSI's clock.

Metallic noise pseudo-randomly changes between a multiple of 1x and a multiple
of 2x the base interval (either 39us or 78us). The pulse width multiple is 
chosen using a xorshift pseudo-random number generator (PRNG). When the pulses
are normalized to 39us or 78us, it becomes evident that t he pseudo-random
pattern repeats itself consistently after every 3,072 pulses, creating a
looping-like sound.

![image](https://github.com/astriiddev/Casiotone-Hi-Hat-Analysis/assets/98296288/0837085d-679b-46c0-8fb0-248cbe86e054)

White noise from the LSI is also generated with an xorshift PRNG, switching
1x to 5x the base interval of 39us. The larger selection of pulse widths
generated randomly creates a similar sound to analog white noise. It is unclear 
if this pattern repeats itself like the metallic noise PRNG does.

The white noise can easily be generated with a 16-bit "798" xorshift PRNG using
a modulo of 5 on the number generated by the PRNG to select between the five 
pulse widths. Metallic noise can be generated by looping through a lookup table
of the 3,072 pulse pattern (at this moment I have not been able to discern 
how the PRNG conistently creates that 3,072 pulse pattern).

The white noise is also used for the snare drum noise.

These are then mixed together at a 5:1 ratio, metallic noise to white noise.
This is then fed into two transistor VCAs/filters. One VCA with a shorter
decay (39nf capacitor) has a 2nd order Sallen-Key 12db/oct high pass filter 
at a cutoff of 4.9khz for the hi hat generation. The cymbal section has a longer 
decay (100nf capacitor) with a 2nd order Sallen-Key 12db/oct high pass filter
at a cutoff of 12.8khz.

![image](https://github.com/astriiddev/Casiotone-Hi-Hat-Analysis/assets/98296288/622a48e8-a436-4e11-a126-c7dfecebd208)

The Casiotone has a unique and iconic hi hat sound with very little documentation
out there for how the hi hats are generated. I hope this analysis brings a bit more
understanding for others to recreate this iconic sound.

# References
1. [Casiotone MT-45/MT-46 Service Manual](https://circuitbending.miraheze.org/wiki/File:Casio_MT-45_and_MT-46_Service_Manual.pdf)
2. [TableHooters Casiotone MT-45](http://weltenschule.de/TableHooters/Casio_MT-45.html)
   
